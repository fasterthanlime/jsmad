/*
pcmdata.js
Uses binary.js and stream.js to parse PCM wave data.
On GitHub:
 * pcmdata.js	http://goo.gl/4uu06
 * binary.js	http://goo.gl/ZaWqK

binary.js repository also includes stream.js

MIT License
*/


(function(b,c){var j=String.fromCharCode,h=true,d=false;function e(k,l){return l?j(k&255)+e(k>>8,l-1):""}function g(k,l){return l?g(k>>8,l-1)+j(255-k&255):""}function i(k,l,m){return m?g(k,l):e(k,l)}function a(r,q){var k=r.length,p=k-1,s=0,o=c.pow,m;if(q){for(m=0;m<k;m++){s+=(255-r.charCodeAt(m))*o(256,p-m)}}else{for(m=0;m<k;m++){s+=r.charCodeAt(m)*o(256,m)}}return s}function f(o,t,n,w){var s=c.pow,r=c.floor,l=f.convertFromBinary,u=f.convertToBinary,k=o/8,q=s(2,o),v=q/2,x=v-1,p=1/v,m=1/x;return w?n?t?function(y,z){y=r(y<0?y*v+q:y*x);return u(y,k,z)}:function(y,z){return u(r(y*x),k,z)}:t?function(y,z){return u(y<0?y+q:y,k,z)}:function(y,z){return u(y,k,z)}:n?t?function(A,z){var y=l(A,z);return y>x?(y-q)*p:y*m}:function(z,y){return l(z,y)*m}:t?function(A,z){var y=l(A,z);return y>x?y-q:y}:function(z,y){return l(z,y)}}f.convertToBinary=i;f.convertFromBinary=a;f.fromFloat32=f(32,h,h,h);f.toFloat32=f(32,h,h,d);f.fromFloat24=f(24,h,h,h);f.toFloat24=f(24,h,h,d);f.fromFloat16=f(16,h,h,h);f.toFloat16=f(16,h,h,d);f.fromFloat8=f(8,h,h,h);f.toFloat8=f(8,h,h,d);f.fromInt32=f(32,h,d,h);f.toInt32=f(32,h,d,d);f.fromInt16=f(16,h,d,h);f.toInt16=f(16,h,d,d);f.fromInt8=f(8,h,d,h);f.toInt8=f(8,h,d,d);f.fromUint32=f(32,d,d,h);f.toUint32=f(32,d,d,d);f.fromUint16=f(16,d,d,h);f.toUint16=f(16,d,d,d);f.fromUint8=f(8,d,d,h);f.toUint8=f(8,d,d,d);b.Binary=f}(this,Math));(function(e,f){function g(h){this.data=h}var d=g.prototype={read:function(i){var h=this,j=h.data.substr(0,i);h.skip(i);return j},skip:function(i){var h=this,j=h.data=h.data.substr(i);h.pointer+=i;return j.length},readBuffer:function(j,n,p){var k=this,o="read"+p+n,q=n/8,h=j.length,m=0;while(k.data&&m<h){j[m++]=k[o]()}return m}},c,b;function a(k,i,j){var h=i/8;d["read"+k+i]=function(l){return j(this.read(h),l)}}for(c in f){b=/to([a-z]+)([0-9]+)/i.exec(c);b&&a(b[1],b[2],f[c])}e.Stream=g;g.newType=a}(this,this.Binary));this.PCMData=(function(a,b){function c(d){return(typeof d==="string"?c.decode:c.encode)(d)}c.decode=function(B){var g=new b(B),n=g.read(4),t=g.readUint32();g=new b(g.read(t));var k=g.read(4),m=g.read(4),r=g.readUint32(),d=new b(g.read(r)),f=d.readUint16(),w=d.readUint16(),z=d.readUint32(),h=d.readUint32(),y=d.readUint16(),x=y/w,l=r===16?d.readUint16():d.readUint32(),e,o,p,u,A,s,j,v,q={};while(g.data){e=g.read(4);o=g.readUint32();u=g.read(o);j=q[e]=q[e]||[];if(e==="data"){p=~~(o/x);A=new b(u);s=new (typeof Float32Array!=="undefined"?Float32Array:Array)(p);A.readBuffer(s,x*8,"Float")}else{j.push(u)}}return{channelCount:w,bytesPerSample:y/w,sampleRate:h/y,chunks:q,data:s}};c.encode=function(x){var s=a.fromUint32,y=a.fromUint16,p=x.data,e=x.sampleRate,j=x.channelCount||1,u=x.bytesPerSample||1,k=u*8,g=j*u,v=e*g,h=p.length,f=h*u,o=Math.pow(2,k-1)-1,d=a["fromFloat"+k],m=[],l="",w,t,q,r;m.push("fmt "+s(16)+y(1)+y(j)+s(e)+s(v)+y(g)+y(k));for(t=0;t<h;t++){l+=d(p[t])}m.push("data"+s(f)+l);r=x.chunks;if(r){for(t in r){if(r.hasOwnProperty(t)){w=r[t];for(q=0;q<w.length;q++){l=w[q];m.push(t+s(l.length)+l)}}}}m=m.join("");return"RIFF"+s(m.length)+"WAVE"+m};return c}(this.Binary,this.Stream));
